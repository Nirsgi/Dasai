<!DOCTYPE html>
	<meta charset="UTF-8">
<link rel="icon" href="favicon.png">
<link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
<head>
<audio id="audio"></audio>
	<title>ヴぇヴぇヴぇえヴぇーい</title>
	<p class="baka" id="baka">とてもクオリティの低いブラウザゲーRPG!<br>プレイする価値があるか?ないか?<br><br>知らねぇよ。</p>
	<style>
		#degita {
			position: absolute;
			top: 0;
			left: 0;
		}
	</style>
</head>

<canvas id="canvas"></canvas>
<div>
<canvas id="canvas1"></canvas>
</div>
<style>
html {
-ms-touch-action:manipulation;
touch-action:manipulation;
}
							
canvas {
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
}
.baka {
	color:#fff;
}
canvas1 {
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
}


</style>
<body bgcolor="#000000">
<script>
//真のマップは下にあるよ
var map0 = '';
var maps = [];
var map1 = [];

</script>

<script>

map0 =  '\
7777777777777777777777777777777777777777777777777777777777777777\
7777777777777777777777777777777777777777777777777777777777777777\
7777777777777777777777777777777777777777777777777777777777777777\
7777777777777777777777777777777777777777777777777777777777777777\
7777777777777777777777777777777777777777777777777777777777777777\
7777777777777777777777777777777777777777777777777777777777777777\
7777777777777777777721133211111111111331111177777777777777777777\
7777777777777777772221222211111111111333111122777777777777777777\
7777777777777777722211122222111111111133111112077777777777777777\
7777777777777777222111122222222222111133311112222777777777777777\
7777777777777722221111022222222222211113331111222207777777777777\
7777777777772222111100022222222222211111331221221100077777777777\
7777777777000222210000002222226222221111332221220000007777777777\
7777777770000022000000002222220222221111333121220000000777777777\
7777777770000000000000000222220022222111133222220000000077777777\
7777777770000000000000000022222002222121131212200000000777777777\
7777777770000000000000000022222202222220032222200000077777777777\
77777777700000001111111000222222022222200022212000000M0007777777\
7777777711100001111111110002222200222220001111200000777007777777\
7777777713111011133333111000022220222200001110200000770007777777\
7777777113301111333113311100000000000000000000000007700007777777\
7777777111333113331111331100000002200000000000000777111007777777\
7777770001133313311111107777000002110000000000007713331117777777\
7777770000113313111001117777700002100000000000077011133333777777\
7777770800007777000000077777770002108000777007770000111111777777\
7777770000777777700000077777770000000077777007700000000000077777\
7777770077777777700000077777777000011077777007700000000000077777\
7777770777777777700006077777777077000077777777700000000000077777\
7777777777777777700000007777777772121777777777700000222200077777\
7777777777777777700000007777777770211077777777770000222220077777\
7777777777777777700000000777777770212007777777770001000220077777\
7777777777777777700007M77777777770000077777770000033300008077777\
7777777777777777700777007777777770000777000000000133330000077777\
7777777777777777777777007777777777777777011111111133330000077777\
7777777777777777777777777777777777777777111111111113333000077777\
7777777000777777777777777777777777777772111111111113333000077777\
7777777010007777777777777777777777777772111111111111033000077777\
7777771111100077777777777777777777777772221111111111000000777777\
7777773333111000077777777777777777777777722222100077770000777777\
7777771113333111000077777777777777777777777222220005070000777777\
7777771111133333310077777777777777777000077222220000777707777777\
7777770111111111133000007777777777000006007222220000777777777777\
7777770000011111311333000000000000000000007222200000077777777777\
7777770000222221111113304000000000000000007222200220007777777777\
7777770000422224111111044000000000440440077222444422000777777777\
7777777000042222222200220000000000444440077004444442200777777777\
7777777000022220474422444000000000004400077000004444220777777777\
7777777700000222202444011111000000000000077000004444227777777777\
7777777770002222222220013331114033333333377000000444447777777777\
7777777777000822000000013333330322000000077000000444477777777777\
777777777770002222220001133100000222000002M000000444777777777777\
7777777777770000022220011331040002220400027000000044777777777777\
7777777777777000000220001131100002224400027700000007777777777777\
7777777777777700008222000133100000000000227722008047777777777777\
7777777777777777002222000113100000000000222722000077777777777777\
7777777777777777770000000013100000222222222772207777777777777777\
7777777777777777700000000013000222220002222277277777777777777777\
7777777777777777772000000013000222220002225277277777777777777777\
7777777777777777777224400013000222200002222277777777777777777777\
7777777777777777777722222223400022277777777777777777777777777777\
7777777777777777777777777777777777777777777777777777777777777777\
7777777777777777777777777777777777777777777777777777777777777777\
7777777777777777777777777777777777777777777777777777777777777777\
7777777777777777777777777777777777777777777777777777777777777777\
'

maps[1] ='00000000990000000000000000000000\
00000000990000000000000000000000\
00000000990000000000000000000000\
000CBBBC99CBBBBBBBBBBBBBC00CBBC0\
000CAAAC99CAAAAAAAAAAAAAC00CAAC0\
000CAAAC99CAAAAAAAAAAAAAC00BCAC0\
000CAAAC99CAAAAAAAAAAAAAC000CAC0\
000BBBBB99BBBBBBBBCFFFFFC000CAC0\
000000009900000000RFFFFFC000BBB0\
000000009900E0E000RFFFFFC0000000\
000000009900000000RFFFFFC0000000\
999999999999999999FFFFFFC0000000\
9999999999E9E99999FFFFFFC0000000\
999999999999999999FFFFFFC0000000\
0000000099000E0000RFFFFFC0000000\
000000009900000000RFFFFFC0000000\
000000009900000000RFFFFFC0000000\
00CBBBBC99CBBBBBBBBFFFFFC0000000\
00CAAAAC99CAAAAAAAAAAAAAC0000000\
00CAAAAC99CAAAAAAAAAAAAAC0000000\
00CAAAAC99CAAAAAAAAAAAAAC0000000\
00BBBBBB99BBBBBBBBBBBBBBB0000000\
00000000999999999999999999999990\
00000000990000000000000000000000\
00444444444444444444444440000000\
00444444444444444444444440000000\
00444444444444444444444440000000\
00444444444444444444444440000000\
00444444444444444444444440000000\
00444444444444444444444440000000\
00000000000000000000000000000000\
77777777777777777777777777777777\
'

var tekis = []
function tekisettei(){

var tek = new Object()
tek.name = 'うさっぴ'
tek.image = 0//Gamedata1を参照されたし。
tek.hp = 10;
tek.maxhp = 10;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 3;
tek.dfc = 3;
tek.spd = 3;
tek.item = 'うさみみ';
tek.itemdrop = 0.1;
tek.x = 0;
tek.kane = 1;
tek.exp = 2;
tek.setumei = 'スライムではない。/ウサギでもない。'
tekis.push(tek)


tek = new Object()
tek.name = 'コモジエー'
tek.image = 1//Gamedata1を参照されたし。
tek.hp = 13;
tek.maxhp = 13;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 5;
tek.dfc = 3;
tek.spd = 5;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 3;
tek.exp = 4;
tek.setumei = '嫌な目で見てくる。/鳴き声は「エェ」。'
tekis.push(tek)


tek = new Object()
tek.name = 'コモジビー'
tek.image = 2//Gamedata1を参照されたし。
tek.hp = 15;
tek.maxhp = 15;
tek.mp = 5;
tek.maxmp = 5;
tek.atk = 3;
tek.dfc = 3;
tek.spd = 4;
tek.item = '';
tek.itemdrop = 0;
tek.setumei = '悲しそうな顔。/鳴き声は「ビィ」。'
tek.x = 0;
tek.kane = 5;
tek.exp = 7;
tekis.push(tek)


tek = new Object()
tek.name = 'コモジシー'
tek.image = 3//Gamedata1を参照されたし。
tek.hp = 18;
tek.maxhp = 18;
tek.mp = 3;
tek.maxmp = 3;
tek.atk = 4;
tek.dfc = 4;
tek.spd = 3;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 8;
tek.exp = 10;
tek.setumei = 'あおいバナナ…ではない。/鳴き声は「シィ」。'
tekis.push(tek)


tek = new Object()
tek.name = 'トケカケ'
tek.image = 4//Gamedata1を参照されたし。
tek.hp = 24;
tek.maxhp = 24;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 11;
tek.dfc = 2;
tek.spd = 2;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 12;
tek.exp = 15;
tek.setumei = '溶けかけてる。'
tekis.push(tek)


tek = new Object()
tek.name = 'モエテル'
tek.image = 5//Gamedata1を参照されたし。
tek.hp = 22;
tek.maxhp = 22;
tek.mp = 10;
tek.maxmp = 10;
tek.atk = 10;
tek.dfc = 3;
tek.spd = 8;
tek.item = 'たいまつ';
tek.itemdrop = 0.1;
tek.x = 0;
tek.kane = 12;
tek.exp = 16;
tek.setumei = '炎上中の魔物。/その割には涼しい顔。'
tekis.push(tek)


tek = new Object()
tek.name = 'サボア'
tek.image = 6//Gamedata1を参照されたし。
tek.hp = 28;
tek.maxhp = 28;
tek.mp = 5;
tek.maxmp = 5;
tek.atk = 15;
tek.dfc = 7;
tek.spd = 7;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 20;
tek.exp = 26;
tek.setumei = '一つ目で三本足のテカテカ化け物。/攻撃対象を見つめる。'
tekis.push(tek)


tek = new Object()
tek.name = 'メトショ'
tek.image = 7//Gamedata1を参照されたし。
tek.hp = 32;
tek.maxhp = 32;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 14;
tek.dfc = 4;
tek.spd = 10;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 22;
tek.exp = 30;
tek.setumei = '目玉と触手。/どこにでもいる化け物。'
tekis.push(tek)


tek = new Object()
tek.name = 'アオウサッピ'
tek.image = 8//Gamedata1を参照されたし。
tek.hp = 38;
tek.maxhp = 38;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 15;
tek.dfc = 7;
tek.spd = 15;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 25;
tek.exp = 36;
tek.setumei = '青いウサッピ。//ただそれだけ。'
tekis.push(tek)


tek = new Object()
tek.name = 'オーモジエー'
tek.image = 9//Gamedata1を参照されたし。
tek.hp = 44;
tek.maxhp = 44;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 18;
tek.dfc = 12;
tek.spd = 19;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 28;
tek.exp = 40;
tek.setumei = 'コモジエーの進化系。/Aランクの魔物というわけではない。'
tekis.push(tek)


tek = new Object()
tek.name = 'オーモジビー'
tek.image = 10//Gamedata1を参照されたし。
tek.hp = 49;
tek.maxhp = 49;
tek.mp = 20;
tek.maxmp = 20;
tek.atk = 10;
tek.dfc = 10;
tek.spd = 17;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 30;
tek.exp = 43;
tek.setumei = 'コモジビーの進化系。/口が二つあるわけではない。'
tekis.push(tek)

tek = new Object()
tek.name = 'オーモジシー'
tek.image = 11//Gamedata1を参照されたし。
tek.hp = 54;
tek.maxhp = 54;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 18;
tek.dfc = 15;
tek.spd = 15;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 36;
tek.exp = 45;
tek.setumei = 'コモジシーの進化系。/黄色いバナナ…ではない。'
tekis.push(tek)


tek = new Object()
tek.name = 'トケテル'
tek.image = 12//Gamedata1を参照されたし。
tek.hp = 68;
tek.maxhp = 68;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 24;
tek.dfc = 7;
tek.spd = 10;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 43;
tek.exp = 53;
tek.setumei = '溶けてる。'
tekis.push(tek)


tek = new Object()
tek.name = 'モエテルゼ'
tek.image = 13//Gamedata1を参照されたし。
tek.hp = 60;
tek.maxhp = 60;
tek.mp = 30;
tek.maxmp = 30;
tek.atk = 24;
tek.dfc = 7;
tek.spd = 19;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 47;
tek.exp = 60;
tek.setumei = '青い炎の魔物。/ガスコンロの炎じゃねーか。'
tekis.push(tek)

tek = new Object()
tek.name = 'クチカラテ'
tek.image = 14//Gamedata1を参照されたし。
tek.hp = 66;
tek.maxhp = 66;
tek.mp = 10;
tek.maxmp = 10;
tek.atk = 27;
tek.dfc = 17;
tek.spd = 18;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 53;
tek.exp = 66;
tek.setumei = '一つ目三本足、口から手の化物。/なんでわざわざ口から手を出すんだ?'
tekis.push(tek)


tek = new Object()
tek.name = 'ショククティ'
tek.image = 15//Gamedata1を参照されたし。
tek.hp = 72;
tek.maxhp = 72;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 27;
tek.dfc = 17;
tek.spd = 30;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 59;
tek.exp = 75;
tek.setumei = 'タコがひっくり返ったのとは違う。/イカでもない。'
tekis.push(tek)


tek = new Object()
tek.name = 'ヴザッビ'
tek.image = 16//Gamedata1を参照されたし。
tek.hp = 80;
tek.maxhp = 80;
tek.mp = 10;
tek.maxmp = 10;
tek.atk = 30;
tek.dfc = 20;
tek.spd = 28;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 66;
tek.exp = 80;
tek.setumei = 'ウサッピをいじめていると、そのうちウサッピはこんなすがたになる。'
tekis.push(tek)


tek = new Object()
tek.name = ' あ '
tek.image = 17//Gamedata1を参照されたし。
tek.hp = 85;
tek.maxhp = 85;
tek.mp = 30;
tek.maxmp = 30;
tek.atk = 28;
tek.dfc = 20;
tek.spd = 30;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 71;
tek.exp = 88;
tek.setumei = 'デザイン'
tekis.push(tek)

tek = new Object()
tek.name = ' い '
tek.image = 18//Gamedata1を参照されたし。
tek.hp = 85;
tek.maxhp = 100;
tek.mp = 20;
tek.maxmp = 20;
tek.atk = 31;
tek.dfc = 25;
tek.spd = 29;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 75;
tek.exp = 94;
tek.setumei = 'いろは歌だと最初に来るのに、五十音順だと二番目。/かわいそうだね。'
tekis.push(tek)


tek = new Object()
tek.name = ' う '
tek.image = 19//Gamedata1を参照されたし。
tek.hp = 93;
tek.maxhp = 93;
tek.mp = 0;
tek.maxmp = 0;
tek.atk = 36;
tek.dfc = 26;
tek.spd = 40;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 80;
tek.exp = 100;
tek.setumei = 'バナナ…ではない……のか?'
tekis.push(tek)


tek = new Object()
tek.name = 'ミテル'
tek.image = 20//Gamedata1を参照されたし。
tek.hp = 96;
tek.maxhp = 96;
tek.mp = 50;
tek.maxmp = 50;
tek.atk = 32;
tek.dfc = 25;
tek.spd = 36;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 87;
tek.exp = 107;
tek.setumei = '見て　る　　。        /おまえ　　を。        /じっと　　見　て　　る　。'
tekis.push(tek)


tek = new Object()
tek.name = 'だーくふぁいあ'
tek.image = 21//Gamedata1を参照されたし。
tek.hp = 101;
tek.maxhp = 101;
tek.mp = 40;
tek.maxmp = 40;
tek.atk = 43;
tek.dfc = 26;
tek.spd = 38;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 94;
tek.exp = 113;
tek.setumei = '暗い炎。/危ない。なぜなら、気が付きにくいからだ。'
tekis.push(tek)

tek = new Object()
tek.name = 'ハモノダス'
tek.image = 22//Gamedata1を参照されたし。
tek.hp = 101;
tek.maxhp = 101;
tek.mp = 40;
tek.maxmp = 40;
tek.atk = 43;
tek.dfc = 26;
tek.spd = 38;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 94;
tek.exp = 113;
tek.setumei = '口から刃物持った手を出してるからハモノダス…いいだろ、分かりやすくて！'
tekis.push(tek)


tek = new Object()
tek.name = 'メトニク'
tek.image = 23//Gamedata1を参照されたし。
tek.hp = 101;
tek.maxhp = 101;
tek.mp = 40;
tek.maxmp = 40;
tek.atk = 43;
tek.dfc = 26;
tek.spd = 38;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 94;
tek.exp = 113;
tek.setumei = 'メトショとショククティ、そしてこいつは、実は草食動物。たたビビりだから狂暴なだけ。'
tekis.push(tek)


tek = new Object()
tek.name = '悪魔の兵士'
tek.image = 24//Gamedata1を参照されたし。
tek.hp = 105;
tek.maxhp = 105;
tek.mp = 30;
tek.maxmp = 30;
tek.atk = 45;
tek.dfc = 28;
tek.spd = 36;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 100;
tek.exp = 120;
tek.setumei = '名前がプロパガンダっぽいねー。'
tekis.push(tek)


tek = new Object()
tek.name = '悪魔の戦士'
tek.image = 25//Gamedata1を参照されたし。
tek.hp = 105;
tek.maxhp = 105;
tek.mp = 30;
tek.maxmp = 30;
tek.atk = 45;
tek.dfc = 28;
tek.spd = 36;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 100;
tek.exp = 120;
tek.setumei = 'やっぱ名前がプロパガンダっぽいねー。'
tekis.push(tek)


tek = new Object()
tek.name = 'ぴょこっぴー'
tek.image = 26//Gamedata1を参照されたし。
tek.hp = 2000;
tek.maxhp = 2000;
tek.mp = 300;
tek.maxmp = 300;
tek.atk = 80;
tek.dfc = 50;
tek.spd = 50;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 1000;
tek.exp = 1000;
tek.setumei = '世界征服を目指す、最強の魔王。/すごいカリスマ性の持ち主。/昔あった先住民の国家、ピョンピョコ王国の王家の末裔だそうだ。'
tekis.push(tek)


tek = new Object()
tek.name = 'シャチョ'
tek.image = 27//Gamedata1を参照されたし。
tek.hp = 2200;
tek.maxhp = 2200;
tek.mp = 200;
tek.maxmp = 200;
tek.atk = 90;
tek.dfc = 52;
tek.spd = 55;
tek.item = '';
tek.itemdrop = 0;
tek.x = 0;
tek.kane = 10000;
tek.exp = 800;
tek.setumei = '「国家戦略総合会社」の社長。/その権威は王をも凌ぐ。/彼の強さの源泉は、巨大な欲望と、毎日食べてるジャムパン。'
tekis.push(tek)

//return tekis
}

</script>

<script>

//canvasの設定（せってい）


function kazu( a ){

if ( a == '0'){return 0}
if ( a == '1'){return 1}
if ( a == '2'){return 2}
if ( a == '3'){return 3}
if ( a == '4'){return 4}
if ( a == '5'){return 5}
if ( a == '6'){return 6}
if ( a == '7'){return 7}
if ( a == '8'){return 8}
if ( a == '9'){return 9}
if ( a == 'A'){return 10}
if ( a == 'B'){return 11}
if ( a == 'C'){return 12}
if ( a == 'D'){return 13}
if ( a == 'E'){return 14}
if ( a == 'F'){return 15}
if ( a == 'G'){return 16}
if ( a == 'H'){return 17}
if ( a == 'I'){return 18}
if ( a == 'J'){return 19}
if ( a == 'K'){return 20}
if ( a == 'L'){return 21}
if ( a == 'M'){return 22}
if ( a == 'N'){return 23}
if ( a == 'O'){return 24}
if ( a == 'P'){return 25}
if ( a == 'Q'){return 26}
if ( a == 'R'){return 27}
if ( a == 'S'){return 28}
if ( a == 'T'){return 29}
if ( a == 'U'){return 30}


}

let baka = document.getElementById("baka");
baka.remove();

canvas.width = window.innerWidth - 50  ;	//canvasの横幅（よこはば）
canvas.height = window.innerHeight - 50  ;	//canvasの縦幅（たてはば）

if (innerHeight > innerWidth){
canvas1.width = window.innerWidth - 50  ;	
canvas1.height = (window.innerHeight - window.innerWidth )  ;	
}else{canvas1.height = 1}


var widorhei = 0

if (innerWidth <= innerHeight){
widorhei = window.innerWidth
canvas.height = canvas.width
}
if (innerWidth > innerHeight){
widorhei = window.innerHeight
canvas.width = canvas.height
}

var ctx = canvas.getContext( '2d' );//コンテキストを取得（しゅとく）
ctx.scale(widorhei / 256,widorhei / 256);
var img = new Image();
img.src = 'GameData1.png'  //'http://twitdoc.com/upload/Nirsgi/GameData1.png'
ctx.imageSmoothingEnabled = false;


var ctx1 = canvas1.getContext( '2d' );//コンテキストを取得（しゅとく）
ctx1.imageSmoothingEnabled = false;

var playing = false
var key = new Object(); //移動系
key.y = 0
key.x = 0
key.push = '';

var fontFace = new FontFace(
  'Pixel', 
  'url(PixelMplus12-Regular.ttf)', 
  { style: 'normal', weight: 700}
);
 
fontFace.load().then(function(loadedFace){
  /// フォント読み込み成功
  /// body要素全体にそれを適用する
  document.fonts.add(loadedFace);
  document.body.style.fontFamily = '"Pixel"';
}).catch(function(e){
  /// フォント読み込み失敗
  console.error('読み込み失敗...');
});



var pp = new Object();
ppp = new Object();//プレイヤー
ppp.name = 'プレイヤ'
ppp.x = 51;
ppp.y = 40
ppp.muki = 0
ppp.ssmd = 0;　//移動中、次のマスまでどのくらいかな
ppp.x1 = ppp.x
ppp.y1 = ppp.y
ppp.x2 = ppp.x
ppp.y2 = ppp.y
ppp.x3 = ppp.x
ppp.y3 = ppp.y

ppp.hp = 10;
ppp.maxhp = 10;
ppp.mp = 10;
ppp.maxmp = 10;
ppp.atk = 10;
ppp.dfc = 10;
ppp.spd = 10;
ppp.soubi =[];
ppp.item = [];
ppp.setumei = '例。モデル。'

var p = []
p[0] =  Object.assign({},ppp)
p[0].name = 'ボロザコ'
p[0].x = 51;
p[0].y = 40
p[0].muki = 0
p[0].ssmd = 0;　//移動中、次のマスまでどのくらいかな
p[0].setumei = '自称勇者。強い雑魚。'
p[0].item = ppp.item.concat()
p[0].soubi = ppp.soubi.concat()
p[1] = Object.assign({},ppp)
p[1].name = 'ヨワッチ'
p[1].setumei = '戦士っぽい人。臆病で勇敢。'
p[1].item = ppp.item.concat()
p[1].soubi = ppp.soubi.concat()
p[2] = Object.assign({},ppp)
p[2].name = 'ユポポ' 
p[2].setumei = '魔法使い(?)。冷酷で優しい。'
p[2].item = ppp.item.concat()
p[2].soubi = ppp.soubi.concat()


//キャラクターーーーーーーーーーーーーーーーーーーーー
var chara = new Object()//モブの見本
chara.map = 0
chara.x = 50
chara.y = 40
chara.muki = 0
chara.image = 7//7から15まで。これに１６をかけて、データから読み込む
chara.text = 'やあ君！君、君！/ああ、俺を忘れたのかい？/俺の名前はイチレイプル！'//宝箱のばあい”宝箱”「扉」だと扉
chara.nktext = ['知らんがな。','なんだよそれ。']//仲間が話すセリフ（ツッコミ）
chara.item = ''//宝箱など。
var mob = []//モブ
mob.push(Object.assign({},chara))

var chara2 = Object.assign({},chara)
chara2.x = 47
chara2.text = '宝箱'
chara2.item = 'ごみ'
mob.push(chara2)

chara2 = Object.assign({},chara)
chara2.map = 1
chara2.x = 20
chara2.y = 10
chara2.text = '扉'
mob.push(chara2)

var nktext = ['','']//仲間が話すテキスト
//戦闘_________________________________________________
var teki =[]
var tek = new Object()
tek.name = '敵'
tek.image = 0//Gamedata1を参照されたし。
tek.hp = 10;
tek.maxhp = 10;
tek.mp = 10;
tek.maxmp = 10;
tek.atk = 10;
tek.dfc = 10;
tek.spd = 10;
tek.item = '';
tek.x = 0;//これに32をかける。(左端の座標なり)
tek.setumei = 'えぁんぷぇ'


function tekida(){//敵出現



}
//________________________________________________

var area = 0//0.1~0.9は、map0(フィールド内)。整数はmapのid。


//ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー

var mv = 0

var mtm = 30;　//見た目切り替え速度　(右手を前?　左手を前?)　大遅
var pmtm = 30;　//上のプレイヤー版
var mt = 0//こいつを切り替え
var pmt = 0

//設定系
var time = 0
var map = [];
var mapid = 0
var btl = 0//1はバトル


function mapc(n){
mapid = n
map = []
 if ( mapid == 0 ) {

  audm = "DasaiWalk"
  for ( i = 0; i < 64; i++){
    map[i] = map0.substr( i * 64 , 64 )
  }
 }else {

 for ( i = 0; i < 32; i++){
   map[i] = maps[mapid].substr( i * 32 , 32 )
  }

}


}


 
mapid = 0
//p[0].x = 20
//p[0].y = 20
mapc(0);


//コントロール系
var s0 = 0//何を選択? 1 YesNo　2フィールド 3バトル　4味方の誰に?  5どの道具　6　道具どうする　7どの特技 8どの敵に  9どの装備 10味方の誰に?
var s1 = [];//s0に選択したやつ

for (i = 0; i < 33; i += 1){s1[i] = 0}

var text = ``//これをteに追加していく。
var te = ''//表示する方
var tepls = ''//後ろに追加 
var tex = 0
var textstop = 0
var mous = 0
var kao = -1
var kaosetu = ''


var aud = new Audio("DasaiBattle.mp3");
aud.loop= true
var audp = ""//audmと一致してなかったらaudを変えよう
var audm = "DasaiWalk"//音楽を買えるならこっちを変更する

var textaud = new Audio("Text.mp3");
var zoom = window.visualViewport.scale
function main() {//メインるーーーーーーーーーーーーーーーーーーーーーーーぷ
//タイマー系


var mtmm = time % mtm;//見た目切り替え
var pmtmm = time % pmtm;//見た目切り替え
if (mtmm == 0){if (mt == 0){mt = 1}; if(mt == 1){mt = 0}}
if (pmtmm == 0){if (pmt == 0){pmt = 1}else{pmt = 0}}

time += 1;




if (text == ''){}else{
 if (time % 3 == 0 && textstop == 0 && s0 == 0) {
  if (tex >= text.length){tex = 0;text = ''}else{
   textaud.currentTime = 0;
   textaud.play();
   te += text.substr(tex,1)
   tex += 1
  }
 }
}

//イベント系


var habataka = window.innerHeight  / window.innerWidth

var ctly = 0//＋の場所
if (window.innerWidth * 1.2 > window.innerHeight ){ctly = window.innerHeight / 2} 
if (window.innerHeight >= window.innerWidth * 1.2){ctly = window.innerWidth + (window.innerHeight - window.innerWidth) / 2 - 50}


function mouse(x,y,a){//a は　down/start (0) かmove(1)かup(2)か。

  var xx = ((window.innerWidth / 2) - (x)) ** 2 
  var yy = ((ctly) - (y)) ** 2
  if (te == '' && key.x == 0 && key.y == 0　&& s0 == 0 && (xx > window.innerHeight ** 2 / 100 || yy > window.innerHeight ** 2 / 100)){
  if ((x <  window.innerWidth / 2 ) && (xx > yy)) {key.x = -10;key.y = 0};
  if ((x >  window.innerWidth / 2 ) && (xx > yy)) {key.x = 10;key.y = 0 };
  if ((y <  ctly ) && (xx < yy)) {key.y = -10;key.x = 0};
  if ((y > ctly )  && (xx < yy)) {key.y = 10;key.x = 0};
  }
if (mv == 0){//初動か判定


 if (s0 > 0 || !(text == '')){
 key.x = 0
 key.y = 0
  if ((x <  window.innerWidth / 2 ) && (xx > yy) && !(xx < window.innerHeight ** 2 / 100 && yy < window.innerHeight ** 2 / 100)) {s1[s0] -= 1 };
  if ((x >  window.innerWidth / 2 ) && (xx > yy) && !(xx < window.innerHeight ** 2 / 100 && yy < window.innerHeight ** 2 / 100)) {s1[s0] += 1 };
  if ((y <  ctly ) && (yy > xx) && (xx > window.innerHeight ** 2 / 100 || yy > window.innerHeight ** 2 / 100)) {push(0) };
  if ((y >  ctly ) && (yy > xx) && (xx > window.innerHeight ** 2 / 100 || yy > window.innerHeight ** 2 / 100)) {push(1) };
 }

 if ((xx < window.innerHeight ** 2 / 100 && yy < window.innerHeight ** 2 / 100)){key.x = 0;key.y = 0;push(0)}//プッシュイヴェント
}
mv = 1
//te = Math.trunc(x) + 'a' + Math.trunc(y) + 'a' +  (window.innerWidth / 2) + 'a' + 
}

//コントロール系

if (playing == true){
window.addEventListener('touchstart' , () => {mous =  1;var touchObject = event.changedTouches[0] ;var touchX = touchObject.pageX ;var touchY = touchObject.pageY ;mouse(touchX,touchY);aud.muted = false})
window.addEventListener('touchmove' , () => {mous = 1; if (mv == 1){var touchObject = event.changedTouches[0] ;var touchX = touchObject.pageX ;var touchY = touchObject.pageY ;mouse(touchX,touchY);aud.muted = false}})
window.addEventListener('touchend', () => {mous = 1;key.x = 0; key.y = 0;mv = 0})

window.addEventListener('keydown', (event) => {
if (event.code == 'ArrowUp'){mouse(window.innerWidth / 2,0)}
if (event.code == 'ArrowDown'){mouse(window.innerWidth /2,window.innerHeight)}
if (event.code == 'ArrowLeft'){mouse(0,ctly)}
if (event.code == 'ArrowRight'){mouse(window.innerWidth,ctly)}
if (event.code == 'Enter'){mouse(window.innerWidth / 2,ctly)}
if (event.code == 'Backspace'){mouse(window.innerWidth /2,window.innerHeight)}
aud.muted = false
});
window.addEventListener('keyup', () => {key.x = 0;key.y = 0;mv = 0});

window.addEventListener('mousedown' , () => { if ( mous == 0){mouse(event.screenX,event.screenY,0);aud.muted = false}})
window.addEventListener('mousemove' , () => { if (mous == 0){ if (mv == 1){mouse(event.screenX,event.screenY,1);}}})
window.addEventListener('mouseup', () => {if (mous == 0){key.x = 0; key.y = 0;mv = 0}})
}
//マップ描画系
if (btl == 0){//フィールド～～～～～～～～～～～～～～～～～～～～～～～～～～～～～

var xs = 0
var ys = 0

if (p[0].muki == 0){ys = 1}
if (p[0].muki == 1){xs = -1}
if (p[0].muki == 2){ys = -1}
if (p[0].muki == 3){xs = 1}
var xs1 = 0
var ys1 = 0
if (p[0].x1 < p[0].x2){xs1 = -1}
if (p[0].x1 > p[0].x2){xs1 = 1}
if (p[0].y1 < p[0].y2){ys1 = -1}
if (p[0].y1 > p[0].y2){ys1 = 1}

var xs2 = 0
var ys2 = 0
if (p[0].x2 < p[0].x3){xs2 = -1}
if (p[0].x2 > p[0].x3){xs2 = 1}
if (p[0].y2 < p[0].y3){ys2 = -1}
if (p[0].y2 > p[0].y3){ys2 = 1}


for (x = p[0].x - 5 ; x < p[0].x + 5; x ++ ) {
for (y = p[0].y - 5; y < p[0].y + 5; y ++ ) {
var x1 = x;//こっちはマップ読み込み用
var y1 = y;//

var x2 = x;//こっちは描画位置用
var y2 = y;
if (x1 < 0) { x1 = 0 }
if (x1 > map[0].length - 1) { x1 = map[0].length -1 }
if (y1 < 0) { y1= 0 }
if (y1 > map.length -1) { y1 = map.length - 1}

var xx = 0
if (y1 >= 0 && y1 <= map.length - 1 && x1 >= 0 && x1 <= map[0].length - 1){
xx = kazu(map[ y1 ].substr( x1 , 1 ));
}else{
//xx = kazu(map[0].substr(0,1))

}
ctx.drawImage(img, Math.trunc(xx  / 8) * 16 , (xx % 8) * 16 ,16,16,(x2 - p[0].x + 5) * 32 - 56 + xs * (p[0].ssmd) ,(y2 - p[0].y+ 5) * 32 -56 + + 3 + ys * (p[0].ssmd) ,32,32);
}
}

var mobs = mob.filter((amob) => { return (amob.map == mapid) && (amob.x > p[0].x - 6) && (amob.x < p[0].x + 6) && (amob.y > p[0].y - 6) && (amob.y < p[0].y + 6) });

for (i = 0;i < mobs.length;i += 1){
if (mobs[i].image >= 0){
if (mobs[i].text == '宝箱' ){
 ctx.drawImage(img,48,16 ,16,16,(mobs[i].x - p[0].x + 5) * 32 - 56 + xs * (p[0].ssmd) ,(mobs[i].y - p[0].y+ 5) * 32 -56 + + 3 + ys * (p[0].ssmd) ,32,32);

}else if (mobs[i].text == '空宝箱' ){
 ctx.drawImage(img,48,32,16,16,(mobs[i].x - p[0].x + 5) * 32 - 56 + xs * (p[0].ssmd) ,(mobs[i].y - p[0].y+ 5) * 32 -56 + + 3 + ys * (p[0].ssmd) ,32,32);
}else if (mobs[i].text == '扉' ){
 ctx.drawImage(img,48,0,16,16,(mobs[i].x - p[0].x + 5) * 32 - 56 + xs * (p[0].ssmd) ,(mobs[i].y - p[0].y+ 5) * 32 -56 + + 3 + ys * (p[0].ssmd) ,32,32);

}else{
 ctx.drawImage(img,mobs[i].image * 16, (mobs[i].muki * 2+ pmt ) * 16 ,16,16,(mobs[i].x - p[0].x + 5) * 32 - 56 + xs * (p[0].ssmd) ,(mobs[i].y - p[0].y+ 5) * 32 -56 + + 3 + ys * (p[0].ssmd) ,32,32);
}
}
}

if (p.length > 2){
 ctx.drawImage(img,96, (p[2].muki * 2 + pmt) * 16 ,16,16,(p[0].x2 - p[0].x + 5) * 32 - 56 + xs * (p[0].ssmd) - xs2 * (p[0].ssmd),(p[0].y2 - p[0].y+ 5) * 32 -56 + + 3 + ys * (p[0].ssmd) - ys2 * (p[0].ssmd)  ,32,32);
}
if (p.length > 1){
 ctx.drawImage(img, 80, (p[1].muki * 2 + pmt) * 16 ,16,16,(p[0].x1 - p[0].x + 5) * 32 - 56 + xs * (p[0].ssmd) - xs1 * (p[0].ssmd),(p[0].y1 - p[0].y+ 5) * 32 -56 + + 3 + ys * (p[0].ssmd) - ys1 * (p[0].ssmd)  ,32,32);
}
 ctx.drawImage(img, 64, (p[0].muki * 2 + pmt) * 16 ,16,16,(4) * 32 - 24,(4) * 32 -24 ,32,32);
//キャラ移動系

if (p[0].ssmd == 0){if (key.x == 0 && key.y == 0 ){}else{
if  (s0 == 0 || te == ''){
move()
}
}
}

if (mapid == 0){
var x = p[0].x
var y = p[0].y
if ((x > 38 && y > 31 && y < 39)||(x > 42 && y >37 && y < 47)){area = 0}
if ((x > 42 && y > 46)||(x > 46 && y >23 && y < 30)){area = 0.1}
if ((x > 26 && y > 47 && x < 43)||(x == 43 && y >56)){area = 0.2}
if (x > 23 && y > 38 && x < 43 && y < 47){area = 0.3}
if (x < 27 && y < 52 && y > 33){area = 0.4}
if (x < 27 && y > 51){area = 0.5}
if ((x > 38 && y < 21)||(x > 39 && y > 19 && x < 46 && y < 28)||(x > 28 && y> 19 && x < 39 && y < 33)){area = 0.6}
if ((x > 24 && y < 21 && x < 38)){area = 0.7} 
if ((x < 16 && y < 28)||(x < 25 && y < 22)){area = 0.8} 
if ((x >15 && y >21 && y < 34 && x < 25)){area = 0.9} 



}else{area = mapid;}


function move() {

p[0].x3 = p[0].x2
p[0].y3 = p[0].y2
p[0].x2 = p[0].x1
p[0].y2 = p[0].y1
p[0].x1 = p[0].x
p[0].y1 = p[0].y


if (key.x < 0){  p[0].x -= 1;p[0].muki =  1;p[0].ssmd = 32} 
if (key.x > 0){  p[0].x += 1;p[0].muki =  3;p[0].ssmd = 32  } 
if (key.y < 0){  p[0].y -= 1;p[0].muki =  2 ;p[0].ssmd = 32 } 
if (key.y > 0){  p[0].y += 1;p[0].muki =  0 ;p[0].ssmd = 32 } 

var px = p[0].x
var py = p[0].y
if (mapid == 0){
if (px == 52 && py == 39){mapc(1)}


}

if (p.length > 1){
if (p[0].x2 < p[0].x1){p[1].muki = 3}
if (p[0].x2 > p[0].x1){p[1].muki = 1}
if (p[0].y2 < p[0].y1){p[1].muki = 0}
if (p[0].y2 > p[0].y1){p[1].muki = 2}
}
if (p.length > 2){
if (p[0].x3 < p[0].x2){p[2].muki = 3}
if (p[0].x3 > p[0].x2){p[2].muki = 1}
if (p[0].y3 < p[0].y2){p[2].muki = 0}
if (p[0].y3 > p[0].y2){p[2].muki = 2}
}
var mapn = 0

var x1 = p[0].x;//マップ読み込み用
var y1 = p[0].y;//
if (x1 < 0) { x1 = 0 }
if (x1 > map[0].length - 1) { x1 = map[0].length -1 }
if (y1 < 0) { y1= 0 }
if (y1 > map.length -1) { y1 = map.length - 1}
mapn =kazu(map[y1].substr(x1, 1 )) //自分のいるタイル

if (mapn == 3 || mapn == 7 || mapn == 11 || mapn == 12 || mapn == 13 || mapn == 19 || mapn == 20 || mapn == 24 || mapn == 27 || mapn == 14||mob.some((amob) => { return (amob.map == mapid) && (amob.x == p[0].x) && (amob.y == p[0].y) && (amob.image >= 0) })){
if (key.x < 0){p[0].x += 1;p[0].ssmd = 0} //壁かモブにぶつかったら、戻る。
if (key.x > 0){p[0].x -= 1;p[0].ssmd = 0} 
if (key.y < 0){p[0].y += 1;p[0].ssmd = 0} 
if (key.y > 0){p[0].y -= 1;p[0].ssmd = 0} 
modoru()
}



}

function modoru() {
p[0].x1 = p[0].x2
p[0].y1 = p[0].y2

p[0].x2 = p[0].x3
p[0].y2 = p[0].y3
}

}else{ctx1.drawImage(img, 48,96 ,16,16,0,0,canvas1.width,canvas1.height);//バトル～～～～～～～～～～～～～～～～～～～～～～


for (i = 0;i < teki.length;i += 1){

}

function suteki(){

var kazu = 1 + Math.trunc(Math.random() * 4)
var tekix = 0
if (kazu % 2 == 1){
tekix += 0.5
}
for (i = 0;i < kazu;i += 1){

}

}

}//～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～
//会話その他
function talk(){

var x1 = p[0].x//プレイヤーの目の前の座標
var y1 = p[0].y

if (p[0].muki == 0){y1 += 1}
if (p[0].muki == 1){x1  += -1}
if (p[0].muki == 2){y1 += -1}
if (p[0].muki == 3){x1 += 1}

var mobtalk =  mob.find((amob) => { return (amob.map == mapid) && (amob.x == x1) && (amob.y == y1)&& (amob.image >= 0)})
if (mobtalk !== undefined && (mobtalk.text == '空宝箱' || mobtalk.text == '宝箱' || mobtalk.text == '扉')){
mobtalk =  undefined
}
 if (mobtalk !== undefined){//モブと話す
text = mobtalk.text
nktext = Array.from(mobtalk.nktext)
mobtalk.muki = (p[0].muki + 2) % 4

 }else{//仲間と話ーす
 if (p.length == 1){nktext[0] = '';nktext[1] = '';text = '話し相手がいないwww'} 
 if (p.length == 2){nktext[1] = ''}

  if (nktext[0] == ''){
   if (nktext[1] == ''){
//話しかけた対象じゃないネタ

   if (area == 0){nktext[0] = 'ここら辺は僕ちゃんの庭…いや、僕ちゃんの部屋みたいなもんだ。/いくら慣れてても、どこに何があるか分かんないからな！'
		  nktext[1] = 'おい' + p[0].name + '、靴紐がほどけてるぞ。/だっさ。/あ、俺のもほどけてるっ…'}
   if (area == 0.1){nktext[0] = 'ちょっと遠出すると自分がどこにいるかわかんなくなるよな。/向かいの店に買い物に行くときとかさ。'
		    nktext[1] = 'おい、さっきからボーっと歩いてんじゃねえよ。/何が起こるかわかんないし、危ないよ。'}
   if (area == 0.2){nktext[0] = '僕ちゃんが一番嫌いなのは、行き止まりだ。/でも八方塞がりは結構好きだな。//…え、理解できないって?'
		    nktext[1] = '山をふもとからから見るのは嫌いだね。頂上から見下すのが好き…/え、「見下ろす」じゃないかって?/俺が好きなのは「見くだす」だよ!'}
   if (area == 0.3){nktext[0] = '最近さぁ…言い間違いが多いっていわわれるんだよね。/あ…ちゃう、「言われる」だ。祝われるじゃない。'
		    nktext[1] = 'おいやる気がない人…お前だよ' + p[0].name + '!　確かに飽きるし疲れるけどさ、やる気出せよ。       /…出さなそうだな。'}
   if (area == 0.4){nktext[0] = 'いやぁ、ここら辺は案外快適な気候だ。'
		    nktext[1] = 'ここら辺はその内全部砂漠になるだろうね。/そんな気がする。'}
   if (area == 0.5){nktext[0] = '腹減ったなぁ…/その辺のモンスター食おう！'
		    nktext[1] = '体力の消耗を抑えたいから、戦闘は避けてくれ。/      /…おい、どうせ聞いてないだろ?'}
   if (area == 0.6){nktext[0] = '努力か、それとも才能か…/へへへ。僕ちゃんはモンスターの名前を全部で3つも覚えたぞ!'
		    nktext[1] = 'モンスターの名前を覚える必要は無い！/誰だよ名付けた奴…適当だろ！'}
   if (area == 0.7){nktext[0] = '森林っていいよな。/なんか地味で暗くて、まるで僕達じゃないか！'
		    nktext[1] = '環境問題に関心があるかって?/なんだい、顔面環境問題君?'}
   if (area == 0.8){nktext[0] = 'ここら辺は良いところだ。将来発展しそうだな。'
		    nktext[1] = 'ここら辺が発展するかって?/どうせ8000年後くらいだろうよ！ハハハ！'}
   if (area == 0.9){nktext[0] = 'モンスターの強さって必ずインフレするよな。/自然の摂理だ。不自然な。'
		    nktext[1] = 'ここら辺のモンスターマジでキモい！/でもなんか飼ってみたい！/         /' + p[0].name + '…そんな目で見るな。'}



   if (nktext[1] == ''){text = p[1].name + ':' + nktext[0];nktext[0] = ''}else{text = p[1 + time % 2].name + ':' + nktext[time % 2];nktext[time % 2] = ''}


   }else{text = p[2].name + ':' + nktext[1];nktext[1] = ''}
  }else{
   if (nktext[1] == ''){text = p[1].name + ':' + nktext[0];nktext[0] = ''}else{text = p[1 + time % 2].name + ':' + nktext[time % 2];nktext[time % 2] = ''}
 }

 }


}

function status(n){
te = ''
text = p[n].name + '/' + 'HP:' + p[n].hp + '(' + p[n].maxhp + ') MP:' + p[n].mp + '(' + p[n].maxmp + ') /攻撃' + p[n].atk + ' 防御 ' + p[n].dfc 
s0 = 0;
kaosetu = p[n].setumei
if (p[n].name == 'ボロザコ'){kao = 0}
if (p[n].name == 'ヨワッチ'){kao = 1}
if (p[n].name == 'ユポポ'){kao = 2}
s1[s0] = 0;//
s1[0] = 0
}


function item(n){
var x1 = p[0].x//プレイヤーの目の前の座標
var y1 = p[0].y
if (p[0].muki == 0){y1 += 1}
if (p[0].muki == 1){x1  += -1}
if (p[0].muki == 2){y1 += -1}
if (p[0].muki == 3){x1 += 1}
var item = ''
if (p[s1[4]].item.length == 0){item = ''}else{item = p[s1[4]].item[s1[5]]}

if (item == ''){

}else{
if (n == 0){
shohi = 0//１にすると削除
if (item == 'ごみ'){}
if (item == 'すごい鍵'){
var mobtalk =  mob.find((amob) => { return (amob.map == mapid) && (amob.x == x1) && (amob.y == y1)})
if (mobtalk !== undefined){//なにかぁがある
	if  (mobtalk.text == '扉' && mobtalk.image >= 0){
	mobtalk.image = -1
	text = '鍵を開けた。'
	}


}
}


}
if (n == 1){
if (s1[4] == s1[10]){
text = p[s1[4]].name + 'は' + p[s1[4]].item + 'を持ち替えた。'
}else{
text = p[s1[4]].name + 'は' + p[s1[4]].item + 'を' + p[s1[10]].name + 'に渡した。'
}
p[s1[10]].item.push(p[s1[4]].item[s1[5]])
p[s1[4]].item.splice(s1[5],1)

}
if (n == 2){
if (item == 'ごみ'||item == 'ゴミ'){
var a = Math.random()
if (a < 0.25){text = 'ゴミだ…'}
else if (a < 0.5){text = 'これはゴミだ。価値はない。'}
else if (a < 0.75){text = 'これはゴミ。/「価値のないものは無い」という考えを真っ向から否定するような……ゴミ。'}
else if (a < 1){text = 'なんとこれはゴミだ！/捨てても問題ないだろう。'}

}
if (item == 'すごい鍵'){text = '扉の前で「使う」か、誰かが持ってる状態で扉を「調べる」ことでどんな扉も開く。/いかにも都合の良い危ない鍵。'}

}
if (n == 3){
if (item == ''||item == ''){
text = item + 'を捨てることはできないなー'
}else{
text = item + 'を捨てた。'
p[s1[4]].item.splice(s1[5],1)
}
}
}
s1[5] = 0;
s1[s0] = 0;
s0 = 0
}

function siraberu(){

var x1 = p[0].x//プレイヤーの目の前の座標
var y1 = p[0].y

if (p[0].muki == 0){y1 += 1}
if (p[0].muki == 1){x1  += -1}
if (p[0].muki == 2){y1 += -1}
if (p[0].muki == 3){x1 += 1}

var mobtalk =  mob.find((amob) => { return (amob.map == mapid) && (amob.x == x1) && (amob.y == y1) && (amob.image >= 0)})
 if (mobtalk !== undefined){//モブと話す
if (mobtalk.text == '宝箱'){
text = mobtalk.item + 'を手に入れた!'
p[0].item.push(mobtalk.item)
mobtalk.text = '空宝箱'
mobtalk.item = ''
}else if  (mobtalk.text == '空宝箱'){
text = '宝箱は空だった！'
nktext[0] = '何してんだ?'
nktext[1] = 'どうみても空だろ。馬鹿だね。'
}else if  (mobtalk.text == '扉' && mobtalk.image >= 0){

for (i = 0;i < p.length;i += 1){
	for (j = 0;j < p[i].item.length;j += 1){
		if (p[i].item[j] == 'すごい鍵'){
　　　　　　　　  mobtalk.image = -1
		 text = '鍵を開けた。'
		}
	}
}
}
if (text == ''){text = '扉は鍵をかけられロックされているようだ。'}
if (nktext[0] == ""){nktext[0] = 'これはアカン！/…なんてね。'}
if (nktext[1] == ""){nktext[1] = 'お前ただでさえ怪しいのに、扉調べてるともっと怪しまれるぞ。'}
}

if (text == ''){text = 'とくに大したものは無い'}

}

//コントロール系
function sss(n){if (s1[s0] == n){return '>'}else{return ' '}}

function act(n){//行動！！！！！！！！！！！！！！！！！！！！！！！！
var s00 = s0//変更しても平気　条件用
if (s00 > 1){te = ''}
if (s00 == 2 && n == 0){talk();s1[s0] = 0;s0 = 0}
if (s00 == 2 && n == 2){siraberu();s1[s0] = 0;s0 = 0}//調べる
if (s00 == 2 && n == 1){s0 = 4}//どの仲間のアイテム?
if (s00 == 2 && n == 3){s0 = 4}//どの仲間のステータス?
if (s00 == 4 && s1[2] == 3){status(n);}//仲間のステータスを見る
if (s00 == 4 && s1[2] == 1){s0 = 5
if (p[s1[4]].item.length == 0){
s0 = 0
text = p[s1[4]].name + 'はアイテムを持ってない！'
}
}//仲間のアイテムを見る
if (s00 == 10 && s1[2] == 1 && s1[6] == 1){item(1)}//仲間にアイテムを渡す
if (s00 == 5){s0 = 6}//アイテムをどのように使う?


if (s00 == 6 && !(n == 1)){item(n)}//アイテムをどのように使う?
if (s00 == 6 && n == 1){s0 = 10}//アイテムを誰に渡す?

}//！！！！！！！！！！！！！！！！！！！！！！

function push(n){//：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：
key.x = 0;
key.y = 0;
kao = -1;
kaosetu = '';
var s00 = s0//これにより、actでs0が変更されても平気

if (n == 0){
if (s00 == 2 && n == 0){act(s1[s0])}
if (s00 == 4 || s00 == 10){te = '';act(s1[s0])}
if (s00 == 5){te = '';act(s1[s0])}
if (s00 == 6){te = '';act(s1[s0])}
if (s00 == 0) {

 if (n == 0 && (te == '')){s0 = 2;}//フィールドでアクションしよう
 if ( textstop > 0 ){textstop = 0;}//テキストストップ解除
 if ( text.length == 0 && !(te == '') ){te = '';}//テキスト消去

 }
}else{
for (i = 0;i < s1.length -1;i +=1){
s1[i] = 0
s0 = 0
te = ''
}
}
	
	
}//push：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：：
	//超えてないか監視
 if (s0 == 1){
 if (s1[s0] < 0){s1[s0] = 1}
 if (s1[s0] > 1){s1[s0] = 0}
 }

if (s0 == 2){
te = sss(0) + '話す' + sss(1) + '道具' + sss(2) + '調べる' + sss(3) + 'ステータス'
 if (s1[s0] < 0){s1[s0] = 3}
 if (s1[s0] > 3){s1[s0] = 0}
 }
if (s0 == 4 || s0 == 10){
var tee = ''
for (i = 0;i < p.length ;i += 1){
tee += sss(i) + p[i].name 
}
te = tee
 if (s1[s0] < 0){s1[s0] = p.length - 1}
 if (s1[s0] > p.length - 1){s1[s0] = 0}
}

if (s0 == 5){
var tee = ''
for (i = 0;i < p[s1[4]].item.length;i += 1){
tee += sss(i) + p[s1[4]].item[i]

if (i % 3 == 2){
tee += '/'
}
}
te = tee
 if (s1[s0] < 0){s1[s0] = p[s1[4]].item.length -1}
 if (s1[s0] > p[s1[4]].item.length - 1){s1[s0] = 0}
}

if (s0 == 6){
te = sss(0) + '使う' + sss(1) + '渡す' + sss(2) + '説明' + sss(3) + '捨てる' 
 if (s1[s0] < 0){s1[s0] = 3}
 if (s1[s0] >3){s1[s0] = 0}
}

if (s0 > 0){key.x = 0;key.y = 0}
//:::::::::::::::::::::::::::::::::::::::::::::::::::::::

//テキスト描画系
function ftx (text, x, y) { //コピペコード。

var noen = 0//改行なし
  for (j =0;j < text.length;j += 1){

   noen += ctx.measureText(text[j]).width / ctx.measureText("あ").width;
   if (text[j] == '/'){noen = 0};
   if (noen >= 17){text = text.slice(0, j) + '/' + text.slice(j);noen = 0}
  }
  var textList = text.split('/');// "/"で分割して配列にするわ。
  var lineHeight = ctx.measureText("あ").width;// あ　はフォントのサイズを取得するのに利用しているだけなり。
  textList.forEach(function(text, i) {//配列を順番に読み出して、y（高さ）を計算しながら描画していくぞよ。
   ctx.fillText(text, x, y+(lineHeight+2)*i);
  });
};


if (te.length > 0){
ctx.strokeStyle = '#fff';
ctx.fillStyle = '#000';
ctx.lineWidth = 2;
ctx.fillRect(0,157,300,155);
if (kao >= 0){ctx.fillRect(0,0,300,300);
ctx.fillStyle = '#fff';ctx.fillText(p[kao].setumei, 68,20);}
if (kao == 0){ctx.drawImage(img, 129,224,32,32,0,0,64,64);}
if (kao == 1){ctx.drawImage(img, 129 + 32,224,32,32,0,0,64,64);}
if (kao == 2){ctx.drawImage(img, 129 + 64,224,32,32,0,0,64,64);}
ctx.font = '14px Pixel'
ctx.fillStyle = '#fff';
ftx(te,2,170)
}else{}


if (p[0].ssmd > 0){p[0].ssmd -= 1} 
if (time > 10000){time = 0}
ctx.fillStyle = '#fff';
ctx1.drawImage(img, 48,112 ,16,16,0,0,canvas1.width,canvas1.height);

//if (aud.playing()){

if (!(audp == audm) && aud.muted == false){
aud.pause()
audp = audm
aud = new Audio(audm + ".mp3");
aud.loop= true
aud.play();
//}
}
requestAnimationFrame(main);
}

//ページと依存（いぞん）している全てのデータが読み込まれたら、メインループ開始
if (playing == false){
document.addEventListener('touchend' , () => {if (playing == false){main();playing = true;aud.muted = false;audp = ''}})
document.addEventListener('mouseup' , () => {if (playing == false){main();playing = true;aud.muted = false;audp = ''}})
document.addEventListener('keydown' , () => {if (playing == false){main();playing = true;aud.muted = false;audp = ''}})
}
var iimg = new Image()
iimg.src = 'title.png'
addEventListener('load',() => {ctx.drawImage(iimg,0,0,256,256);
ctx.font = '14px Pixel'
ctx.fillStyle = '#f0f';
ctx.fillText('タップorクリックorキー操作で開始',2,170)})

window.addEventListener('visibilitychange', function() {
    if (document.visibilityState === 'hidden') {
	aud.muted = true;
    } else {
	aud.muted = false;
    }
});

// スクロールを禁止にする関数
function disableScroll(event) {
  event.preventDefault();
　document.body.style.zoom=1.0
}

// スクロール禁止
  document.addEventListener('touchmove', disableScroll, { passive: false });
  document.addEventListener('mousewheel', disableScroll, { passive: false });

	</script>
</body>
</html>
